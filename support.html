<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <title>JINSUL-ìˆ˜ë‚© ê²€ìˆ˜ ì‹œìŠ¤í…œ</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>
  <style>
    :root {
      --blue: #228be6; --red: #fa5252; --green: #2b8a3e; --yellow: #f08c00; --gray: #868e96;
      --bg: #f8f9fa; 
      --card-bg: rgba(255, 255, 255, 0.0); 
      --border: rgba(0, 0, 0, 0.1); 
      --thead: rgba(243, 244, 246, 0.0);
    }
    * { box-sizing: border-box; }
    body { 
      margin: 0; background: var(--bg); color: #111827;
      font-family: system-ui, -apple-system, 'Apple SD Gothic Neo', sans-serif;
      position: relative; min-height: 100vh;
      overflow-x: hidden;
    }

    .watermark {
      position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%);
      width: 500px; max-width: 80vw; height: auto; 
      opacity: 0.12; 
      z-index: -1; pointer-events: none;
      filter: grayscale(1);
    }

    header { padding: 40px 16px 20px; text-align: center; position: relative; z-index: 10; }
    header .logo {
      width: 200px; max-width: 70vw; height: auto; display: block; margin: 0 auto 12px;
      filter: grayscale(1) saturate(0) brightness(.4) contrast(1.1);
    }
    header h2 { font-size: 1.6rem; margin: 0; color: #1f2937; letter-spacing: -0.5px; font-weight: 800; }

    .container { width: 100%; max-width: 1550px; margin: 0 auto; padding: 0 20px 60px; position: relative; z-index: 5; }
    
    .card { 
      background: var(--card-bg); 
      backdrop-filter: blur(1px); 
      -webkit-backdrop-filter: blur(1px);
      border-radius: 24px; padding: 30px; 
      box-shadow: 0 8px 32px rgba(0,0,0,0.03); 
      border: 1px solid rgba(255,255,255,0.3);
      margin-bottom: 25px; 
    }

    .guide-bar {
      display: flex; gap: 20px; justify-content: center; margin-bottom: 25px;
      padding: 15px; background: rgba(255, 255, 255, 0.2); 
      border-radius: 12px; border: 1px solid rgba(0,0,0,0.05);
      font-size: 0.85rem; line-height: 1.6; color: #4b5563;
    }
    .guide-item { flex: 1; text-align: left; max-width: 500px; }
    .guide-item strong { color: var(--blue); font-weight: 800; display: block; margin-bottom: 4px; }

    .dashboard {
      display: grid; grid-template-columns: repeat(3, 1fr); gap: 15px; margin-bottom: 20px;
    }
    .dash-box {
      padding: 20px; border-radius: 16px; background: rgba(255,255,255,0.4); 
      border: 1px solid rgba(255,255,255,0.5); text-align: center;
    }
    .dash-box h4 { margin: 0 0 10px; font-size: 0.9rem; color: #6b7280; }
    .dash-val { font-size: 1.3rem; font-weight: 900; color: #1f2937; display: block; margin-bottom: 5px; }
    .dash-sub { font-size: 0.8rem; color: #6b7280; }
    .dash-sub b { color: var(--blue); }

    .grid { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 20px; }

    /* [ìˆ˜ì •] ë“œë¡­ì¡´ ë””ìì¸ ê°•í™” */
    .file-zone { 
      border: 2px dashed rgba(0,0,0,0.15); padding: 40px 20px; border-radius: 20px; 
      text-align: center; background: rgba(255,255,255,0.1); 
      transition: all 0.3s ease;
      cursor: pointer;
      position: relative;
    }
    .file-zone:hover, .file-zone.drag-over {
      border-color: var(--blue);
      background: rgba(34, 139, 230, 0.05);
      transform: scale(1.01);
    }
    .file-zone strong { display: block; margin-bottom: 10px; font-size: 1.1rem; }
    .file-zone p { font-size: 0.8rem; color: var(--gray); margin-top: 10px; }
    
    .calendar-area { margin-top: 20px; display: none; }
    .calendar-grid { display: grid; grid-template-columns: repeat(7, 1fr); gap: 8px; max-width: 400px; margin: 15px auto 0; }
    .day-btn { 
      padding: 12px 5px; border: 1px solid rgba(0,0,0,0.05); background: rgba(255,255,255,0.6); 
      border-radius: 10px; cursor: pointer; font-weight: bold; transition: 0.2s; 
    }
    .day-btn:hover { background: var(--blue); color: white; }
    .day-btn.active { background: var(--blue); color: white; border-color: var(--blue); box-shadow: 0 5px 15px rgba(34, 139, 230, 0.3); }
    .day-btn.disabled { opacity: 0.2; cursor: not-allowed; }

    .filter-bar { 
      display: flex; align-items: center; justify-content: space-between; 
      margin-bottom: 15px; padding: 18px; 
      background: rgba(231, 245, 255, 0.4); 
      border-radius: 16px; border: 1px solid rgba(34, 139, 230, 0.1);
    }
    .switch-container { display: flex; align-items: center; gap: 12px; cursor: pointer; font-weight: 700; color: var(--blue); }
    .switch { position: relative; display: inline-block; width: 48px; height: 24px; }
    .switch input { opacity: 0; width: 0; height: 0; }
    .slider { position: absolute; cursor: pointer; inset: 0; background-color: #adb5bd; transition: .4s; border-radius: 34px; }
    .slider:before { position: absolute; content: ""; height: 18px; width: 18px; left: 3px; bottom: 3px; background-color: white; transition: .4s; border-radius: 50%; }
    input:checked + .slider { background-color: var(--red); }
    input:checked + .slider:before { transform: translateX(24px); }

    table { width: 100%; border-collapse: collapse; margin-top: 10px; background: transparent; }
    th { background: var(--thead); padding: 14px; border: 1px solid var(--border); color: #374151; font-weight: 700; }
    td { padding: 12px; text-align: center; border: 1px solid var(--border); background: rgba(255, 255, 255, 0.0); }
    
    .row-err { background: rgba(250, 82, 82, 0.15) !important; font-weight: bold; }
    .row-misu { background: rgba(134, 142, 150, 0.1) !important; color: var(--gray); }
    .diff-text { color: var(--red); font-weight: 800; }
    .hidden { display: none; }

    .badge { padding: 5px 10px; border-radius: 7px; font-size: 0.85rem; font-weight: 800; display: inline-block; margin: 1px; }
    .m1 { background: rgba(235, 251, 238, 0.7); color: #2b8a3e; border: 1px solid #b2f2bb; } 
    .m2 { background: rgba(255, 249, 219, 0.7); color: #f08c00; border: 1px solid #ffec99; } 
    .m3 { background: rgba(255, 245, 245, 0.7); color: #e03131; border: 1px solid #ffc9c9; } 
    .m6 { background: rgba(243, 240, 255, 0.7); color: #7048e8; border: 1px solid #d0bfff; } 
  </style>
</head>
<body>

<img src="jinsul-logo.png" class="watermark" alt="JINSUL WATERMARK" />

<header>
  <img src="jinsul-logo.png" alt="JINSUL" class="logo" />
  <h2>JINSUL-ìˆ˜ë‚© ê²€ìˆ˜ ì‹œìŠ¤í…œ</h2>
</header>

<div class="container">
  <div class="card">
    <div class="guide-bar">
      <div class="guide-item">
        <strong>ğŸ–¥ï¸ ë¹„íŠ¸ì»´í“¨í„° (Bit EHR)</strong>
        ì ‘ìˆ˜ â†’ ì¼ì¼ì§‘ê³„ â†’ ì§‘ê³„(í´ë¦­) â†’ ì—‘ì…€(ë‹¤ìš´ë¡œë“œ)
      </div>
      <div class="guide-item">
        <strong>ğŸ¥ ì˜ì‚¬ë‘ (U-isarang)</strong>
        ì›ë¬´ê³¼ ì™¸ë˜ â†’ ë§ˆê° â†’ ì¼ì¼ë§ˆê° â†’ ë§ˆê°(í´ë¦­) â†’ ì—‘ì…€ì¶œë ¥(ë‹¤ìš´ë¡œë“œ)
      </div>
    </div>

    <div class="grid">
      <div class="file-zone" id="dropA">
        <strong style="color:var(--blue);">ğŸ“„ 1. ì§„ì„¤ ì¼ì¼ ìˆ˜ë‚© ëŒ€ì¥</strong>
        <span>í´ë¦­í•˜ê±°ë‚˜ íŒŒì¼ì„ ì´ ì˜ì—­ìœ¼ë¡œ ëŒì–´ë‹¤ ë†“ìœ¼ì„¸ìš”</span>
        <input type="file" id="fileA" style="display:none;" />
        <div id="calendarArea" class="calendar-area">
          <div id="calendarGrid" class="calendar-grid"></div>
        </div>
      </div>
      <div class="file-zone" id="dropB">
        <strong style="color:var(--gray);">ğŸ’» 2. ì°¨íŠ¸ ì¼ì¼ ìˆ˜ë‚© ì—‘ì…€</strong>
        <span>í´ë¦­í•˜ê±°ë‚˜ íŒŒì¼ì„ ì´ ì˜ì—­ìœ¼ë¡œ ëŒì–´ë‹¤ ë†“ìœ¼ì„¸ìš”</span>
        <input type="file" id="fileB" style="display:none;" />
        <div id="logB" style="font-size:0.9rem; margin-top:20px; color:#6b7280; font-weight:600;">ê²€ìˆ˜ë¥¼ ìœ„í•´ íŒŒì¼ì„ ì—…ë¡œë“œí•˜ì„¸ìš”</div>
      </div>
    </div>
  </div>

  <div id="resCard" class="card" style="display:none;">
    <div class="dashboard" id="dashBoard">
      <div class="dash-box">
        <h4>ğŸ’µ í˜„ê¸ˆ+ì´ì²´ í•©ê³„</h4>
        <span class="dash-val" id="sumCashLedger">0ì›</span>
        <div class="dash-sub" id="sumCashProg">í”„ë¡œê·¸ë¨: 0ì›</div>
        <div class="dash-sub" id="diffCash">ì°¨ì•¡: <b>0ì›</b></div>
      </div>
      <div class="dash-box">
        <h4>ğŸ’³ ì¹´ë“œ ìˆ˜ë‚© í•©ê³„</h4>
        <span class="dash-val" id="sumCardLedger">0ì›</span>
        <div class="dash-sub" id="sumCardProg">í”„ë¡œê·¸ë¨: 0ì›</div>
        <div class="dash-sub" id="diffCard">ì°¨ì•¡: <b>0ì›</b></div>
      </div>
      <div class="dash-box">
        <h4>ğŸ“Š ì´ ìˆ˜ë‚©ì•¡ í•©ê³„</h4>
        <span class="dash-val" id="sumTotLedger">0ì›</span>
        <div class="dash-sub" id="sumTotProg">í”„ë¡œê·¸ë¨: 0ì›</div>
        <div class="dash-sub" id="diffTot">ì°¨ì•¡: <b>0ì›</b></div>
      </div>
    </div>

    <div class="filter-bar">
      <label class="switch-container">
        <div class="switch">
          <input type="checkbox" id="errToggle" onchange="applyFilter()" />
          <span class="slider"></span>
        </div>
        <span>âš ï¸ ì°¨ì•¡ ë° ëˆ„ë½ ëª…ë‹¨ë§Œ ì§‘ì¤‘ ë³´ê¸°</span>
      </label>
      <div id="summary" style="font-weight: 800; color: #1f2937;"></div>
    </div>
    <div style="overflow-x: auto;">
      <table>
        <thead>
          <tr>
            <th rowspan="2">ì°¨íŠ¸ë²ˆí˜¸</th><th rowspan="2">í™˜ìëª…</th>
            <th colspan="2">í˜„ê¸ˆ+ì´ì²´</th><th colspan="2">ì¹´ë“œ</th>
            <th colspan="2">ì´ì•¡</th><th rowspan="2">ê²€ìˆ˜ê²°ê³¼</th><th rowspan="2">ìˆ˜ë‹¨ìƒì„¸</th>
          </tr>
          <tr>
            <th>ìˆ˜ë‚©ëŒ€ì¥</th><th>í”„ë¡œê·¸ë¨</th><th>ìˆ˜ë‚©ëŒ€ì¥</th><th>í”„ë¡œê·¸ë¨</th><th>ìˆ˜ë‚©ëŒ€ì¥</th><th>í”„ë¡œê·¸ë¨</th>
          </tr>
        </thead>
        <tbody id="resBody"></tbody>
      </table>
    </div>
  </div>
</div>

<script>
  let currentWbA = null, dbA = [], dbB = [], confA = null, confB = null;
  const methodNames = { 1: "í˜„ê¸ˆ", 2: "ì¹´ë“œ", 3: "ë¯¸ìˆ˜", 4: "ë¯¸ìˆ˜(í˜„)", 5: "ë¯¸ìˆ˜(ì¹´)", 6: "ì´ì²´" };
  const norm = (s) => String(s || "").trim().replace(/\s/g, "");
  const toN = (v) => Math.round(Number(String(v || 0).replace(/[^0-9.-]+/g, ""))) || 0;
  const normId = (id) => String(id || "").trim().replace(/^0+/, "");
  
  const TAGS = {
    id: ['ì°¨íŠ¸ë²ˆí˜¸', 'ì± íŠ¸ë²ˆí˜¸', 'ë“±ë¡ë²ˆí˜¸'],
    name: ['ì„±ëª…', 'ìˆ˜ì§„ìëª…', 'ìˆ˜ì§„ì', 'ì´ë¦„'],
    total: ['ì›ë¬´ê³¼ì…ê¸ˆì•¡', 'ìˆ˜ë‚©ì•¡', 'ìˆ˜ë‚©ì•¡í•©ê³„', 'í•©ê³„'],
    cash: ['í˜„ê¸ˆìˆ˜ë‚©ì•¡', 'í˜„ê¸ˆê¸ˆì•¡', 'í˜„ê¸ˆ'],
    card: ['ì¹´ë“œìˆ˜ë‚©ì•¡', 'ì¹´ë“œê¸ˆì•¡', 'ì¹´ë“œ'],
    acc: ['ê³„ì¢Œì´ì²´ì•¡', 'ê³„ì¢Œê¸ˆì•¡', 'ê³„ì¢Œ']
  };

  function getMap(rows, side) {
    for (let i = 0; i < Math.min(rows.length, 50); i++) {
      const row = rows[i]; if (!row) continue;
      const map = {};
      row.forEach((cell, idx) => {
        const c = norm(cell);
        for (let k in TAGS) { if (TAGS[k].includes(c)) map[k] = idx; }
        if (side === 'A') {
          if (String(cell).includes("ê¸ˆ") && String(cell).includes("ì•¡") && idx < 10) map.total = idx;
          if (c.includes("ìˆ˜ë‹¨(ì…ë ¥)")) map.method = idx;
        }
      });
      if (map.id !== undefined) return { index: i, map };
    }
    return null;
  }

  // [ê¸°ëŠ¥ ì¶”ê°€] ë“œë˜ê·¸ ì•¤ ë“œë¡­ ì„¤ì • í•¨ìˆ˜
  function setupDropZone(dropId, inputId, handler) {
    const zone = document.getElementById(dropId);
    const input = document.getElementById(inputId);

    zone.onclick = () => input.click();
    zone.ondragover = (e) => { e.preventDefault(); zone.classList.add('drag-over'); };
    zone.ondragleave = () => zone.classList.remove('drag-over');
    zone.ondrop = (e) => {
      e.preventDefault();
      zone.classList.remove('drag-over');
      const file = e.dataTransfer.files[0];
      if (file) handler(file);
    };
    input.onchange = (e) => { if (e.target.files[0]) handler(e.target.files[0]); };
  }

  // íŒŒì¼ A ì²˜ë¦¬
  const handleFileA = (file) => {
    const reader = new FileReader();
    reader.onload = (e) => {
      currentWbA = XLSX.read(new Uint8Array(e.target.result), { type: 'array' });
      renderCalendar();
      if (dbA.length > 0 && dbB.length > 0) runCheck();
    };
    reader.readAsArrayBuffer(file);
  };

  // íŒŒì¼ B ì²˜ë¦¬
  const handleFileB = (file) => {
    const reader = new FileReader();
    reader.onload = (e) => {
      const wb = XLSX.read(new Uint8Array(e.target.result), { type: 'array' });
      const raw = XLSX.utils.sheet_to_json(wb.Sheets[wb.SheetNames[0]], { header: 1, defval: "" });
      const res = getMap(raw, 'B');
      confB = { data: raw.slice(res ? res.index+1 : 0), map: res ? res.map : {} };
      dbB = confB.data;
      document.getElementById('logB').innerText = res ? `âœ… ${file.name} ë¡œë“œ ì™„ë£Œ` : "âŒ í•­ëª© ì¸ì‹ ì‹¤íŒ¨";
      if (dbA.length > 0 && dbB.length > 0) runCheck();
    };
    reader.readAsArrayBuffer(file);
  };

  // ì´ˆê¸° ì…‹ì—…
  setupDropZone('dropA', 'fileA', handleFileA);
  setupDropZone('dropB', 'fileB', handleFileB);

  function renderCalendar() {
    const grid = document.getElementById('calendarGrid'); grid.innerHTML = "";
    const today = new Date().getDate();
    const sheetList = currentWbA.SheetNames.map(n => norm(n));
    for (let i = 1; i <= 31; i++) {
      const btn = document.createElement('button');
      btn.className = 'day-btn'; btn.innerText = i;
      const exists = sheetList.includes(i.toString());
      if (!exists) btn.classList.add('disabled');
      if (i === today && exists) { btn.classList.add('active'); loadSheetData(i.toString()); }
      btn.onclick = (e) => {
        e.stopPropagation(); // ë¶€ëª¨ í´ë¦­ ì´ë²¤íŠ¸ ë°©ì§€
        if (!exists) return;
        document.querySelectorAll('.day-btn').forEach(b => b.classList.remove('active'));
        btn.classList.add('active'); loadSheetData(i.toString());
        runCheck();
      };
      grid.appendChild(btn);
    }
    document.getElementById('calendarArea').style.display = "block";
  }

  function loadSheetData(day) {
    const ws = currentWbA.Sheets[day];
    const raw = XLSX.utils.sheet_to_json(ws, { header: 1, defval: "" });
    const res = getMap(raw, 'A');
    confA = { data: raw.slice(res ? res.index+1 : 0), map: res ? res.map : {} };
    dbA = confA.data;
  }

  function runCheck() {
    if (!dbA.length || !dbB.length) return;
    const body = document.getElementById('resBody'); body.innerHTML = "";
    const aggA = new Map(), aggB = new Map();
    const allIds = new Set();
    let tAC=0, tAK=0, tAT=0, tBC=0, tBK=0, tBT=0;

    dbA.forEach(row => {
      const id = normId(row[confA.map.id]);
      if (!id || isNaN(id) || !row[confA.map.name]) return;
      allIds.add(id);
      if(!aggA.has(id)) aggA.set(id, { name: row[confA.map.name], cash: 0, card: 0, total: 0, methods: new Set() });
      const ent = aggA.get(id);
      const amt = toN(row[confA.map.total]), met = parseInt(row[confA.map.method]);
      if ([1, 4, 6].includes(met)) ent.cash += amt; else if ([2, 5].includes(met)) ent.card += amt;
      ent.total += amt; if(met) ent.methods.add(met);
    });

    dbB.forEach(row => {
      const id = normId(row[confB.map.id]); if(!id) return;
      allIds.add(id);
      if(!aggB.has(id)) aggB.set(id, { name: row[confB.map.name], cash: 0, card: 0, total: 0 });
      const ent = aggB.get(id), m = confB.map;
      ent.cash += (toN(row[m.cash]) + toN(row[m.acc]));
      ent.card += toN(row[m.card]);
      ent.total += (toN(row[m.total]) || (ent.cash + ent.card));
    });

    let totalCnt = 0, errCnt = 0;
    Array.from(allIds).sort((a,b)=>a-b).forEach(id => {
      totalCnt++;
      const dataA = aggA.get(id); const dataB = aggB.get(id);
      let res = "ì •ìƒ", isErr = false;
      const misuOnly = dataA && dataA.methods.size === 1 && dataA.methods.has(3);

      if (dataA && !dataB) { res = misuOnly ? "ë¯¸ìˆ˜ëŒ€ê¸°" : "ìˆ˜ë‚© ë¯¸ì²˜ë¦¬"; isErr = !misuOnly; }
      else if (!dataA && dataB) { res = "ìˆ˜ë‚©ëŒ€ì¥ ë¯¸ê¸°ì¬"; isErr = true; }
      else if (dataA && dataB) {
        const dTot = dataA.total - dataB.total;
        const dCash = dataA.cash - dataB.cash;
        const dCard = dataA.card - dataB.card;
        if (dTot !== 0 && !misuOnly) { res = "ì´ì•¡ì˜¤ë¥˜"; isErr = true; }
        else if ((Math.abs(dCash) > 50 || Math.abs(dCard) > 50) && !misuOnly) { res = "ìˆ˜ë‹¨ì˜¤ë¥˜"; isErr = true; }
        else if (misuOnly) res = "ë¯¸ìˆ˜ëŒ€ê¸°";
      }

      const aC = dataA ? dataA.cash : 0, aK = dataA ? dataA.card : 0, aT = dataA ? dataA.total : 0;
      const bC = dataB ? dataB.cash : 0, bK = dataB ? dataB.card : 0, bT = dataB ? dataB.total : 0;
      if(!misuOnly) { tAC+=aC; tAK+=aK; tAT+=aT; tBC+=bC; tBK+=bK; tBT+=bT; }

      if (isErr) errCnt++;
      const tr = document.createElement('tr');
      tr.dataset.error = isErr;
      if (isErr) tr.className = "row-err"; else if (res === "ë¯¸ìˆ˜ëŒ€ê¸°") tr.className = "row-misu";
      
      tr.innerHTML = `
        <td>${id}</td><td>${dataA?dataA.name:(dataB?dataB.name:'-')}</td>
        <td class="${aC!==bC?'diff-text':''}">${aC.toLocaleString()}</td><td>${bC.toLocaleString()}</td>
        <td class="${aK!==bK?'diff-text':''}">${aK.toLocaleString()}</td><td>${bK.toLocaleString()}</td>
        <td class="${aT!==bT?'diff-text':''}">${aT.toLocaleString()}</td><td>${bT.toLocaleString()}</td>
        <td style="color:${isErr?'red':(res==='ë¯¸ìˆ˜ëŒ€ê¸°'?'var(--gray)':'var(--blue)')}"><b>${res}</b></td>
        <td>${dataA ? Array.from(dataA.methods).map(m => `<span class="badge m${m}">${methodNames[m]||m}</span>`).join(' ') : '<span class="badge" style="color:red">ê¸°ë¡ì—†ìŒ</span>'}</td>
      `;
      body.appendChild(tr);
    });

    document.getElementById('sumCashLedger').innerText = tAC.toLocaleString() + "ì›";
    document.getElementById('sumCashProg').innerText = "í”„ë¡œê·¸ë¨: " + tBC.toLocaleString() + "ì›";
    document.getElementById('diffCash').innerHTML = "ì°¨ì•¡: <b style='color:"+(tAC-tBC!==0?'red':'inherit')+"'>" + (tAC-tBC).toLocaleString() + "ì›</b>";
    document.getElementById('sumCardLedger').innerText = tAK.toLocaleString() + "ì›";
    document.getElementById('sumCardProg').innerText = "í”„ë¡œê·¸ë¨: " + tBK.toLocaleString() + "ì›";
    document.getElementById('diffCard').innerHTML = "ì°¨ì•¡: <b style='color:"+(tAK-tBK!==0?'red':'inherit')+"'>" + (tAK-tBK).toLocaleString() + "ì›</b>";
    document.getElementById('sumTotLedger').innerText = tAT.toLocaleString() + "ì›";
    document.getElementById('sumTotProg').innerText = "í”„ë¡œê·¸ë¨: " + tBT.toLocaleString() + "ì›";
    document.getElementById('diffTot').innerHTML = "ì°¨ì•¡: <b style='color:"+(tAT-tBT!==0?'red':'inherit')+"'>" + (tAT-tBT).toLocaleString() + "ì›</b>";

    document.getElementById('summary').innerText = `ì´ ${totalCnt}ê±´ ëŒ€ì¡° / ë¶ˆì¼ì¹˜ ${errCnt}ê±´ ë°œê²¬`;
    document.getElementById('resCard').style.display = "block";
    applyFilter();
  }

  function applyFilter() {
    const onlyErr = document.getElementById('errToggle').checked;
    document.querySelectorAll('#resBody tr').forEach(tr => {
      tr.classList.toggle('hidden', onlyErr && tr.dataset.error === 'false');
    });
  }
</script>
</body>
</html>
